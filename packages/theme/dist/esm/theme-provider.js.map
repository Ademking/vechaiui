{"version":3,"sources":["../../src/theme-provider.tsx"],"names":["walkObject","omit","toRGB","deepmerge","createContext","useContext","useLayoutEffect","useMemo","set","defaultTheme","toCSSVar","ThemeContext","undefined","displayName","ThemeProvider","theme","colorScheme","children","computedTheme","omittedTheme","colors","type","colorSchemes","document","documentElement","classList","add","remove","value","path","rgb","join","normalizedTheme","updateThemeVariables","__cssVars","setStyleVariable","name","rootStyle","style","setProperty","updateStyleHelper","_themeKey","themeKey","startsWith","vars","Object","entries","forEach","key","val","useTheme","Error","extendTheme","themeOverride"],"mappings":";;AAAA,SACEA,UADF,EAEEC,IAFF,EAGEC,KAHF,EAIEC,SAJF,QAOO,iBAPP;AAQA,SAASC,aAAT,EAAwBC,UAAxB,EAAoCC,eAApC,EAAqDC,OAArD,QAAoE,OAApE;AACA,OAAOC,GAAP,MAAgB,YAAhB;AAEA,SAASC,YAAT,QAA6B,iBAA7B;AACA,SAASC,QAAT,QAAyB,qBAAzB;AAKA,OAAO,IAAMC,YAAY,gBAAGP,aAAa,CAKvCQ,SALuC,CAAlC;AAOPD,YAAY,CAACE,WAAb,GAA2B,cAA3B;AAQA,OAAO,SAASC,aAAT,OAIiB;AAAA,MAJM;AAC5BC,IAAAA,KAAK,GAAGN,YADoB;AAE5BO,IAAAA,WAAW,GAAG,OAFc;AAG5BC,IAAAA;AAH4B,GAIN;AACtB,MAAMC,aAAa,GAAGX,OAAO,CAAC,MAAM;AAClC,QAAMY,YAAY,GAAGlB,IAAI,CAACc,KAAD,EAAQ,CAAC,cAAD,CAAR,CAAzB;AACA,QAAM;AAAEK,MAAAA,MAAF;AAAUC,MAAAA;AAAV,QAAmBN,KAAK,CAACO,YAAN,CAAmBN,WAAnB,KAAmC,EAA5D;AACA,QAAIK,IAAI,KAAK,MAAb,EAAqBE,QAAQ,CAACC,eAAT,CAAyBC,SAAzB,CAAmCC,GAAnC,CAAuC,MAAvC,EAArB,KACKH,QAAQ,CAACC,eAAT,CAAyBC,SAAzB,CAAmCE,MAAnC,CAA0C,MAA1C;AAEL3B,IAAAA,UAAU,CAACoB,MAAD,EAAS,CAACQ,KAAD,EAAQC,IAAR,KAAiB;AAClC,UAAI,OAAOD,KAAP,KAAiB,QAArB,EAA+B;AAC/B,UAAME,GAAG,GAAG5B,KAAK,CAAC0B,KAAD,CAAjB;AACA,UAAIE,GAAJ,EAAStB,GAAG,CAACY,MAAD,EAASS,IAAT,EAAeC,GAAG,CAACC,IAAJ,CAAS,GAAT,CAAf,CAAH;AACV,KAJS,CAAV;;AAMA,QAAMC,eAAe,gBAChBb,YADgB;AAEnBC,MAAAA;AAFmB,MAArB;;AAIA,WAAOV,QAAQ,CAACsB,eAAD,CAAf;AACD,GAjB4B,EAiB1B,CAACjB,KAAD,EAAQC,WAAR,CAjB0B,CAA7B;AAmBAV,EAAAA,eAAe,CAAC,MAAM;AACpB2B,IAAAA,oBAAoB,CAACf,aAAa,CAACgB,SAAf,CAApB;AACD,GAFc,EAEZ,CAAChB,aAAD,CAFY,CAAf;AAIA,MAAMU,KAAK,GAAGrB,OAAO,CACnB,OAAO;AACLQ,IAAAA,KAAK,EAAEG;AADF,GAAP,CADmB,EAInB,CAACA,aAAD,CAJmB,CAArB;AAOA,sBACE,oBAAC,YAAD,CAAc,QAAd;AAAuB,IAAA,KAAK,EAAEU;AAA9B,KAAsCX,QAAtC,CADF;AAGD;;AAED,SAASkB,gBAAT,CAA0BC,IAA1B,EAAwCR,KAAxC,EAAuD;AACrD,MAAMS,SAAS,GAAGd,QAAQ,CAACC,eAAT,CAAyBc,KAA3C;AACAD,EAAAA,SAAS,CAACE,WAAV,CAAsBH,IAAtB,EAA4BR,KAA5B;AACD;;AAED,SAASY,iBAAT,CAA2BC,SAA3B,EAA8CH,KAA9C,EAA6D;AAC3D,MAAMI,QAAQ,GAAGD,SAAS,CAACE,UAAV,CAAqB,IAArB,IAA6BF,SAA7B,UAA8CA,SAA/D;AACAN,EAAAA,gBAAgB,CAACO,QAAD,EAAWJ,KAAX,CAAhB;AACD;;AAED,SAASL,oBAAT,CAA8BW,IAA9B,EAA4D;AAC1DC,EAAAA,MAAM,CAACC,OAAP,CAAeF,IAAf,EAAqBG,OAArB,CAA6B,SAAgB;AAAA,QAAf,CAACC,GAAD,EAAMC,GAAN,CAAe;AAC3CT,IAAAA,iBAAiB,CAACQ,GAAD,EAAMC,GAAN,CAAjB;AACD,GAFD;AAGD;;AAED,OAAO,SAASC,QAAT,GAA6C;AAClD,MAAMnC,KAAK,GAAGV,UAAU,CACrBM,YADqB,CAAxB;;AAGA,MAAI,CAACI,KAAL,EAAY;AACV,UAAMoC,KAAK,CACT,0FADS,CAAX;AAGD;;AAED,SAAOpC,KAAP;AACD;AAED,OAAO,SAASqC,WAAT,CAAqBC,aAArB,EAAsE;AAC3E,SAAOlD,SAAS,CAACM,YAAD,EAAe4C,aAAf,CAAhB;AACD","sourcesContent":["import {\n  walkObject,\n  omit,\n  toRGB,\n  deepmerge,\n  WithCSSVar,\n  Dict,\n} from \"@vechaiui/utils\";\nimport { createContext, useContext, useLayoutEffect, useMemo } from \"react\";\nimport set from \"lodash.set\";\n\nimport { defaultTheme } from \"./default-theme\";\nimport { toCSSVar } from \"./create-theme-vars\";\nimport { VechaiTheme, VechaiThemeOverride } from \"./types\";\n\ninterface DictVechaiTheme extends Dict {}\n\nexport const ThemeContext = createContext<\n  | {\n      theme: WithCSSVar<DictVechaiTheme>;\n    }\n  | undefined\n>(undefined);\n\nThemeContext.displayName = \"ThemeContext\";\n\nexport interface VechaiProviderProps {\n  children: React.ReactNode;\n  theme: VechaiTheme;\n  colorScheme: string;\n}\n\nexport function ThemeProvider({\n  theme = defaultTheme,\n  colorScheme = \"light\",\n  children,\n}: VechaiProviderProps) {\n  const computedTheme = useMemo(() => {\n    const omittedTheme = omit(theme, [\"colorSchemes\"]);\n    const { colors, type } = theme.colorSchemes[colorScheme] || {};\n    if (type === \"dark\") document.documentElement.classList.add(\"dark\");\n    else document.documentElement.classList.remove(\"dark\");\n\n    walkObject(colors, (value, path) => {\n      if (typeof value !== \"string\") return;\n      const rgb = toRGB(value);\n      if (rgb) set(colors, path, rgb.join(\",\"));\n    });\n\n    const normalizedTheme = {\n      ...omittedTheme,\n      colors,\n    };\n    return toCSSVar(normalizedTheme);\n  }, [theme, colorScheme]);\n\n  useLayoutEffect(() => {\n    updateThemeVariables(computedTheme.__cssVars);\n  }, [computedTheme]);\n\n  const value = useMemo(\n    () => ({\n      theme: computedTheme,\n    }),\n    [computedTheme]\n  );\n\n  return (\n    <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>\n  );\n}\n\nfunction setStyleVariable(name: string, value: string) {\n  const rootStyle = document.documentElement.style;\n  rootStyle.setProperty(name, value);\n}\n\nfunction updateStyleHelper(_themeKey: string, style: string) {\n  const themeKey = _themeKey.startsWith(\"--\") ? _themeKey : `--${_themeKey}`;\n  setStyleVariable(themeKey, style);\n}\n\nfunction updateThemeVariables(vars: Record<string, string>) {\n  Object.entries(vars).forEach(([key, val]) => {\n    updateStyleHelper(key, val);\n  });\n}\n\nexport function useTheme<T extends object = Dict>() {\n  const theme = useContext(\n    (ThemeContext as unknown) as React.Context<T | undefined>\n  );\n  if (!theme) {\n    throw Error(\n      \"useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ThemeProvider />`\"\n    );\n  }\n\n  return theme as WithCSSVar<T>;\n}\n\nexport function extendTheme(themeOverride: VechaiThemeOverride): VechaiTheme {\n  return deepmerge(defaultTheme, themeOverride) as VechaiTheme;\n}\n"],"file":"theme-provider.js"}